;**************************************;; RawtoGeos;;**************************************.if Pass1 ;Only need to include these files        ;during assembler's first pass..include geosSym ;get GEOS definitions.include geosMac ;get GEOS macro definitions.endif.psect ;program code section starts here      ;(GeoLinker will give this an address of $0400);**************************************; Application Initialization;**************************************ProgStart: jsr UseSystemFont jsr MouseUp jsr InitScreen jsr InitIcons jsr DoMain jmp EnterDeskTop;**************************************; initialize Display;**************************************InitScreen: LoadB dispBufferOn,# (ST_WR_FORE ö ST_WR_BACK) ;allow writes to foreground and background LoadW r0,#ClearScreen ;point to graphics string to clear screen jsr GraphicsString rts;**************************************; ClearScreen Graphics Code Table;**************************************ClearScreen:         ;graphics string table to clear screen  .byte NEWPATTERN,2 ;set new pattern value .byte MOVEPENTO   ;move pen to:  .word 0           ;top left corner of screen .byte 0 .byte RECTANGLETO  ;draw filled rectangle to bottom right corner .word 319 .byte 199 .byte NULL         ;end of graphics table;**************************************;;**************************************InitIcons: LoadW r0,#DummyIconTable ;point to icon definition table jsr DoIcons                ;have GEOS draw the icons on the screen rts;**************************************; Dummy Icon Table;**************************************DummyIconTable: .byte 1      ;number of icons .word 0     ;x position to place mouse at when done .byte 0      ;y position to place mouse at when done .word 0     ;pointer to compacted bitmap for icon .byte 0      ;x position in bytes .byte 0      ;y position in scanlines .byte 1       ;width of icon in bytes .byte 1       ;height of icon in scanlines  .word $0000 ;pointer to handler routine;**************************************; Main Code;**************************************DoMain: nop jsr XX04CF ; call main loop rts;**************************************; Do About DialogBox;**************************************XX0445: LoadW r0,#XX0481 jsr DoDlgBox rts;**************************************; Dialog Box (exit on click);; Level 0 test application; Designed by Denton Marlowe; Version 1.0, Copyright 1988; Shadow Systems;;**************************************XX0481: .byte $81    ; DEF_DB_POS ö Pattern .byte $0E    ; DBSYSOPV .byte $0B    ; DBTXTSTR .byte $10    ; xoffset .byte $10    ; yoffset .word DText2 ; Pointer to String .byte $0B    ; DBTXTSTR .byte $10    ; xoffset .byte $20    ; yoffset .word DText3 ; Pointer to String .byte $0B    ; DBTXTSTR .byte $10    ; xoffset .byte $30    ; yoffset .word DText4 ; Pointer to String .byte $0B    ; DBTXTSTR .byte $10    ; xoffset .byte $40    ; yoffset .word DText5 ; Pointer to String .byte $00    ; NULL end of dialog box;**************************************;;**************************************DText2: .byte $18 .byte "Level 0 Test Application" .byte $1B .byte $00DText3: .byte $18 .byte "Designed by Denton Marlowe" .byte $1B .byte $00DText4: .byte $18 .byte "Version 1.0, Copyright 1988" .byte $1B .byte $00DText5: .byte $18 .byte "Shadow Systems" .byte $1B .byte $00;**************************************; Main Loop;**************************************XX04CF: nopXX04D0: LoadW r0,#XX04EB jsr DoDlgBox lda r0L cmp #2 beq XX04E7 jsr XX050F clv bvc XX04D0XX04E7: jsr XX0445 ;<-------- about box and then exit rts;**************************************; Dialog Box;; Run Test APPLICATION;; ÄCANCELÜ       ÄOKÜ;;**************************************XX04EB: .byte $81 ; DEF_DB_POS ö Pattern .byte $0B ; DXTXTSTR  .byte $0E ; xoffset .byte $14 ; yoffset .word DText1 ; Pointer to String .byte $02 ; ÄCANCELÜ .byte $02 ; xoffset .byte $47 ; yoffset .byte $01 ; ÄOKÜ .byte $0F ; xoffset .byte $46 ; yoffset .byte $00 ; NULL end of dialog box;**************************************; DialogBox Text;**************************************DText1: .byte $18 .byte "Run Test Application" .byte $1B .byte $00;**************************************;;**************************************XX050F: nop jsr XX0514 rts;**************************************;;**************************************XX0514: LoadB r7L,#0 LoadW r0,#0 LoadW r5,#XX05F7 LoadW r10,#0 jsr XX0805 cpx #0 beq XX0538 ;<----------- rts;**************************************;;**************************************XX0538: LoadW r6,#XX05F7 jsr FindFile cpx #0 beq XX0548 rts;**************************************;;**************************************XX0548: LoadW a1,r1 LoadW a5,r5;**************************************;;************************************** LoadW r0,#XX0637 jsr DoDlgBox;**************************************;;************************************** lda r0L cmp #1 beq XX056A rts;**************************************;;**************************************XX056A: jsr GetDirHead lda #0 sta r2H lda #240 sta r2L lda #6 sta r6H lda #23 sta r6L jsr BlkAlloc cpx #0 bne XX05E8 lda r2L cmp #0 beq XX05E8 lda r3H sta r1H lda r3L sta r1L;**************************************;;************************************** lda #7 sta r4H lda #5 sta r4L jsr PutBlock;**************************************;;************************************** cpx #0 bne XX05E8 ldy #19 lda r1L sta (a5L),y iny lda r1H sta (a5L),y iny lda #0 sta (a5L),y iny  lda #3 sta (a5L),y iny  ldx #4XX05B9: lda $84FF,y sta (a5L),y iny dex bne XX05B9 lda a1H sta r1H lda a1L sta r1L lda #128 sta r4H lda #0 sta r4L jsr PutBlock cpx #0 bne XX05E8 jsr PutDirHead;**************************************;;************************************** LoadW r0,#XX0679 jsr DoDlgBox rtsXX05E8: jsr XX0A91 LoadW r0,#XX06A0 jsr DoDlgBox rts;**************************************;;**************************************XX05F7:.block $20XX0617:.block $20;**************************************; Last Chance to Abort DialogBox;**************************************XX0637: .byte $81 ; DEF_SB_POS ö pattern .byte $0B ; DBTXTSTR .byte $10 ; xpos_offset .byte $10 ; ypos_offset .word XX0649 ; pointer to text string .byte $0B ; DBTXTSTR .byte $10 ; xpos_offset .byte $20 ; ypos_offset .word XX0661 ; pointer to text string .byte $01 ; ÄOKÜ .byte $01 ; xpos_in_bytes .byte $48 ; ypos_in_lines .byte $02 ; ÄCANCELÜ .byte $11 ; xpos_in_bytes .byte $48 ; ypos_in_lines .byte $00 ; end of dialog;**************************************;;**************************************XX0649: .byte $18 .byte "last chance to abort!" .byte $1B .byte $00;**************************************;;**************************************XX0661: .byte $18 .byte "press cancel to quit!" .byte $1B .byte $00;**************************************; File Conversion Successful DialogBox;**************************************XX0679: .byte $81 ; DEF_SB_POS ö pattern .byte $0B ; DBTXTSTR .byte $10 ; xpos_offset .byte $10 ; ypos_offset .word XX0683 ; pointer to text string .byte $01 ; ÄOKÜ .byte $01 ; xpos_in_bytes .byte $48 ; ypos_in_bytes .byte $00 ; end of dialog;**************************************;;**************************************XX0683: .byte $18 .byte "File conversion successful" .byte $1B .byte $00;**************************************; Disk Error - Validate the Disk DialogBox;**************************************XX06A0: .byte $81 ; DEF_SB_POS ö pattern .byte $0B ; DBTXTSTR .byte $10 ; xpos_offset .byte $10 ; ypos_offset .word XX06AA ; pointer to text string .byte $01 ; ÄOKÜ .byte $01 ; xpos_in_bytes .byte $48 ; upos_in_bytes .byte $00 ; end of dialog;**************************************;;**************************************XX06AA: .byte $18 .byte "Disk error - validate the disk!" .byte $1B .byte $00 ;**************************************; Input Permanent Name Dialog Box;**************************************XX06CC: .byte $81 ; DEF_SB_POS ö pattern .byte $0B ; DBTXTSTR  .byte $10 ; xpos_offset .byte $20 ; ypos_offset .word XX06D8 ; pointer to text string .byte $0D ; DBGETSTRING .byte $10 ; xpos_offset .byte $30 ; ypos_offset .byte $0C ; RegNumber .byte $10 ; MaxChars .byte $00 ; end of dialog;**************************************;;**************************************XX06D8: .byte $18 .byte "permenant name:" .byte $1B .byte $00;**************************************; Input author name DialogBox;**************************************XX06EA: .byte $81 ; DEF_SB_POS ö pattern .byte $0B ; DBTXTSTR .byte $10 ; xpos_offset .byte $20 ; ypos_offset .word XX06F6 ; pointer to text string .byte $0D ; DBGETSTRING .byte $10 ; xpos_offset .byte $30 ; ypos_offset .byte $0C ; RegNumber .byte $10 ; MaxChars .byte $00 ; end of dialog;**************************************;;**************************************XX06F6: .byte $18 .byte "author name:" .byte $1B .byte $00;**************************************; 256 byte block;**************************************XX0705: .byte $00,$00,$03,$15,$BF,$FF,$C0,$00,$9C,$00,$00,$AA,$00,$00,$98,$00 .byte $40,$F0,$00,$00,$B8,$00,$00,$B0,$39,$0C,$E0,$38,$1C,$E0,$72,$0E .byte $A0,$B2,$0A,$E0,$A1,$03,$E0,$10,$C0,$E1,$04,$00,$E0,$80,$A0,$80 .byte $63,$F0,$E0,$A0,$F0,$C0,$5C,$7C,$E0,$1F,$98,$F0,$01,$00,$F8,$00 .byte $00,$FF,$FF,$FF,$82,$03,$00,$00,$00,$00,$00,$00,$00,$52,$41,$57 .byte $20,$20,$20,$20,$20,$20,$20,$20,$20,$56,$31,$2E,$30,$00,$20,$20 .byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 .byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 .byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 .byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 .byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 .byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 .byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 .byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 .byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 .byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00;**************************************;;**************************************XX0805: LoadW XX088B,r0 LoadW XX088D,r7 LoadW XX088F,r5 LoadW XX0891,r10;**************************************;;**************************************XX082D: LoadW r0,#XX0893 jsr DoDlgBox;**************************************;;************************************** lda r0L cmp #2 beq XX0883 cmp #5 beq XX0888 cmp #6 beq XX084B cmp #11 beq XX0855 brkXX084B: jsr XX0A0D ;<-------- cpx #0 bne XX088A clv bvc XX0862XX0855: jsr XX0A70 ;<-------- cpx #0 bne XX088A jsr XX0AEF ;<--------Dummy rts clv bvc XX0862XX0862: lda XX088E sta r7L lda XX088D sta r7H lda XX0890 sta r5H lda XX088F sta r5L lda XX0892 sta r10H lda XX0891 sta r10L clv bvc XX082DXX0883: ldx #255 clv bvc XX088AXX0888: ldx #0XX088A: rts;**************************************;;**************************************XX088B: .byte $00XX088C: .byte $00XX088D: .byte $00XX088E: .byte $00XX088F: .byte $00XX0890: .byte $00XX0891: .byte $00XX0892: .byte $00;**************************************; Custom GetFile Open,Disk and Custom Drive icons;**************************************XX0893: .byte $81 ; DEF_SB_POS ö pattern .byte $13 ;DB_USR_ROUT .word XX08B3 ; pointer to user routine .byte $10 ; Future expansion .byte $04 ; xpos .byte $04 ; ypos .byte $0B ; DBTXTSTR .byte $82 ; xpos_offset .byte $0A ; ypos_offet .word XX08EA .byte $0B ; DBTXTSTR .byte $82 ; xpos_offset .byte $14 ; ypos_offet .word XX08F5 ; Text Buffer to Hold Current File Name .byte $05 ; ÄOPENÜ .byte $11 ; xpos_in_bytes .byte $19 ; ypos_in_lines .byte $02 ; ÄCANCELÜ .byte $11 ; xpos_in_bytes .byte $4C ; ypos_in_lines .byte $12 ; DBUSRICON .byte $11 ; x_offset .byte $3B ; y_offset .word XX09ABXX08AF: .byte $06 ; ÄDISKÜ .byte $11 ; xpos_in_bytes .byte $2A ; ypos_in_bytes .byte $00 ; end of dialogbox;**************************************;;**************************************XX08B3: lda #0 sta mouseXPos+1 lda #224 sta mouseXPos lda #65 sta mouseYPos jsr XX08C6 jsr XX0915 rts;**************************************;;**************************************XX08C6: ldx curDrive ldy #0XX08CB: cpx #9 beq XX08D5 lda DrACurDkNm,y clv bvc XX08D8XX08D5: lda DrBCurDkNm,yXX08D8: cmp #160 beq XX08E4 sta XX08F5,y iny cpy #17 bne XX08CBXX08E4: lda #0 sta XX08F5,y rts;**************************************;;**************************************XX08F5: .block $20;**************************************;;**************************************XX08EA: .byte $18 .byte "On disk:" .byte $1B .byte $00;**************************************;;**************************************XX0915: lda numDrives cmp #2 beq XX0933 lda #0 ; if only one drive disable ÄDRIVEÜ sta XX09AC lda #0 sta XX09AB lda #1 sta XX09AF lda #1 sta XX09B0 clv  bvc XX0955XX0933: lda #ÜXX09BB ; if two drives enable ÄDRIVEÜ sta XX09AC lda #ÄXX09BB sta XX09AB lda #6 sta XX09AF lda #16 sta XX09B0 lda curDrive sec sbc #8 tax lda driveType,x and #128 bne XX0960XX0955: jsr XX0966 bcs XX0960 lda #6 sta XX08AF rts;**************************************;;**************************************XX0960: lda #0 sta XX08AF rts;**************************************;;**************************************XX0966: lda XX088C cmp #0 bne XX0972 lda XX088B cmp #0XX0972: beq XX09A7 lda XX088C cmp #255 bne XX0980  lda XX088B cmp #255XX0980: beq XX099F lda #8 sta r0H lda #245 sta r0L lda XX088C sta r1H lda XX088B sta r1L ldx #2 ldy #4 jsr CmpString beq XX09A9 bne XX09A7XX099F: lda curDrive cmp XX088D beq XX09A9XX09A7: clc rts;**************************************;;**************************************XX09A9: sec rts;**************************************; USER ICON Data Table;**************************************XX09AB: .byte #ÄXX09BB ; ptr to icon data lowXX09AC: .byte #ÜXX09BB ; ptr to icon data highXX09AD: .byte $00 ; x positionXX09AE: .byte $00 ; y positionXX09AF:  .byte $06 ; width in bytes XX09B0: .byte $10 ; height in pixelsXX09B1: .word XX09B3 ; Service Routine;**************************************; USER ICON Service Routine;**************************************XX09B3:; .byte $A9,$0B,$8D,$1D,$85,$4C,$BF,$C2 lda #$0B sta $851D jmp $C2BF;**************************************; USER ICON Data;**************************************XX09BB: .byte $05,$FF,$82,$FE,$80,$04,$00,$82,$03,$80,$04,$00,$B7,$03,$80,$F8 .byte $00,$C0,$00,$03,$80,$CC,$00,$00,$00,$03,$80,$C6,$FD,$D9,$9E,$03 .byte $80,$C6,$E0,$D9,$B3,$03,$80,$C6,$C0,$D9,$B3,$03,$80,$C6,$C0,$CF .byte $3F,$03,$80,$C6,$C0,$CF,$30,$03,$80,$CC,$C0,$C6,$33,$03,$80,$F8 .byte $C0,$C6,$1E,$03,$E2,$02,$01,$80,$04,$00,$01,$03,$06,$FF,$01,$7F .byte $05,$FF;**************************************; Insert New Disk into Drive Code;**************************************XX0A0D: LoadW r0,XX0A23 ; insert new disk into drive jsr DoDlgBox    ; DialogBox jsr OpenDisk cpx #0 beq XX0A22 jsr XX0A91XX0A22: rts;**************************************;;**************************************XX0A23: .byte $81 ; .byte $13 ; DB_USR_ROUT .word XX0A30 .byte $0B ; DBTXTSTR .byte $10 ; offset .byte $10 ; offset .word XX0A51 .byte $01 ; ÄOKÜ .byte $11 ; xpos_in_bytes .byte $48 ; ypos_in_lines .byte $00 ; end of dialogbox;**************************************; USR Routine From insert in disk into drive; DialogBox (XX0A23);**************************************XX0A30: lda #0 sta mouseXPos+1 lda #224 sta mouseXPos lda #112 sta mouseYPos lda curDrive cmp #8 bne XX0A4B lda #65 sta XX0A6D ;drive number clv bvc XX0A50;**************************************;;**************************************XX0A4B: lda #66 sta XX0A6D ;drive numberXX0A50: rts ;**************************************;;**************************************XX0A51: .byte $18 .byte "Insert new disk into drive "XX0A6D:  .byte "A" .byte $1B .byte $0;**************************************;;**************************************XX0A70: lda curDrive cmp #8 beq XX0A7C lda #8 clv bvc XX0A7EXX0A7C: lda #9XX0A7E: jsr SetDevice cpx #0 bne XX0A8D jsr OpenDisk cpx #0 bne XX0A8D rtsXX0A8D: jsr XX0A91 rts;**************************************;;**************************************XX0A91: cpx #0 beq XX0AA6 stx XX0AEE LoadW r0,#XX0AA7 ; disk error code jsr DoDlgBox     ; DialogBox ldx XX0AEEXX0AA6: rts;**************************************;;**************************************XX0AA7: .byte $81 .byte $13 ; DB_USR_ROUT .word XX0AB4 .byte $0B ; DBTXTSTR .byte $10 .byte $10 .word XX0ADB .byte $01 ; ÄOKÜ .byte $11 ; xpos_in_bytes .byte $48 ; ypos_in_lines .byte $00 ; end of dialog box;**************************************;;**************************************XX0ADB: .byte $18 .byte "Disk Error Code " .byte $1B .byte $00XX0AEE: .byte $00XX0AEF: rts;**************************************; USR Routine From disk error code; DialogBox (XX0AA7);**************************************XX0AB4: lda #0 sta mouseXPos+1 lda #224 sta mouseXPos lda #112 sta mouseYPos lda XX0AEE sta mouseYPos lda XX0AEE sta r0L lda #0 sta r0H lda #0 sta r11H lda #239 sta r11L lda #48 sta r1H lda #192 jsr PutDecimal rts;**************************************;;**************************************